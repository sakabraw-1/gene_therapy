<footer class="footer-main">
  <div class="footer-progress-outer">
    <div class="footer-progress-panel">
      <div class="footer-progress-arrow">
        <svg width="90" height="40" viewBox="0 0 90 40" fill="none">
          <path d="M5 20 Q 30 5, 55 20 T 85 20" stroke="#E57373" stroke-width="3" fill="none" stroke-dasharray="5,5"/>
          <path d="M80 15 L 90 20 L 80 25" fill="#E57373"/>
        </svg>
      </div>
      <div class="footer-progress-label">Support Our $3.5M Goal for CDKL5 Therapy!</div>
      <div style="flex: 1; max-width: 400px; display: flex; align-items: center;">
        <div class="footer-progress-bar large enhanced" style="flex: 1; margin: 0;">
          <div class="footer-progress enhanced" style="width: 25%"></div>
          <div class="footer-progress-indicator"></div>
        </div>
        <span class="footer-progress-amount" style="margin-left: 14px; white-space:nowrap;">$3.5M Goal</span>
      </div>
      <a href="donate.html" class="footer-btn footer-progress-cta">TAKE ACTION</a>
    </div>
  </div>
  <div class="footer-container">
    <div class="footer-grid">
      <!-- Donate Card -->
      <div class="footer-card">
        <h3>Donate</h3>
        <p>Support our work — every donation accelerates research and trials.</p>
        <a href="donate.html" class="footer-btn">Donate</a>
      </div>
      <!-- Newsletter Card -->
      <div class="footer-card">
        <h3>Stay Connected</h3>
        <form id="footer-newsletter" name="footer-newsletter" class="footer-form" method="POST" data-netlify="true" data-netlify-ajax="true" netlify-honeypot="bot-field">
          <input type="hidden" name="form-name" value="footer-newsletter">
          <p style="display:none">
            <label>Don't fill this out if you're human: <input name="bot-field" /></label>
          </p>
          <input type="text" name="firstName" placeholder="First name" required>
          <input type="text" name="lastName" placeholder="Last name" required>
          <input type="email" name="email" placeholder="Email" required>
          <button type="submit" class="footer-btn">Subscribe</button>
        </form>
        <div id="footer-newsletter-success" style="display:none; margin-top:1rem; padding:1rem; background:rgba(255,255,255,0.2); border-radius:8px; text-align:center; color:#fff; font-weight:600;">
          ✓ Thank you for subscribing! We'll keep you updated.
        </div>
      </div>
      <!-- Fundraising Card -->
      <div class="footer-card">
        <div class="footer-goal-badge">Our Goal</div>
        <div class="footer-progress-bar large enhanced">
          <div class="footer-progress enhanced" style="width: 25%"></div>
          <div class="footer-progress-indicator"></div>
        </div>
        <div class="footer-goal-amount">$3.5M <span>to bring hope to families</span></div>
        <div class="footer-quote-card" style="margin-top:1.2em; text-align:center; color:#5e35b1; font-style:italic; font-size:1.08em;">
          "Together, we are the cure."
        </div>
    </div>
  </div>
  <!-- Partnership Section (Below all cards) -->
  <div style="text-align: center; padding: 1.5rem 0; margin-top: 0.5rem;">
    <p style="font-size: 1.15rem; color: rgba(255,255,255,0.8); margin-bottom: 0.8rem; font-weight: 600;">
      Supported by
    </p>
    <p style="font-size: 1.05rem; color: white; margin: 0; line-height: 1.6;">
      <a href="https://childscure.org/" target="_blank" rel="noopener noreferrer" class="footer-partner-link">Child's Cure Genetic Research</a>
      <span style="margin: 0 0.75rem; opacity: 0.6; font-size: 1rem;">•</span>
      <a href="https://cdkl5southasia.com/" target="_blank" rel="noopener noreferrer" class="footer-partner-link">CDKL5 South Asia</a>
    </p>
  </div>
  <!-- Legal/Privacy -->
  <div class="footer-legal">
    <span>Privacy Policy: We respect your privacy. | Terms of Use: Standard terms apply. | Medical Disclaimer: This site shares research updates and is not medical advice. Donations support 501(c)(3) led programs.</span>
  </div>
</footer>

<!-- Mobile Bottom Tab Bar Navigation - ONLY ON MOBILE -->
<nav class="mobile-tab-bar" id="mobile-tab-bar" style="display: none;">
    <a href="index.html" class="tab-item" data-page="index">
        <svg class="tab-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
            <polyline points="9 22 9 12 15 12 15 22"></polyline>
        </svg>
        <span class="tab-label">Home</span>
    </a>
    
    <button class="tab-item" id="about-tab-btn" data-page="about">
        <svg class="tab-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
        </svg>
        <span class="tab-label">About</span>
    </button>
    
    <a href="get-involved.html" class="tab-item" data-page="get-involved">
        <svg class="tab-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span class="tab-label">Involved</span>
    </a>
    
    <a href="frequently-asked-questions.html" class="tab-item" data-page="faq">
        <svg class="tab-icon" viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        <span class="tab-label">FAQ</span>
    </a>
    
    <a href="donate.html" class="tab-item tab-item-donate" data-page="donate">
        <svg class="tab-icon" viewBox="0 0 24 24" width="24" height="24" fill="currentColor" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span class="tab-label">Donate</span>
    </a>
</nav>

<!-- About Popup for Mobile Tab Bar -->
<div class="about-popup" id="about-popup" style="display: none;">
    <div class="about-popup-content">
        <a href="about.html" class="about-popup-item">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            <span>About Us</span>
        </a>
        <a href="about-cdkl5.html" class="about-popup-item">
            <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
                <line x1="16" y1="13" x2="8" y2="13"></line>
                <line x1="16" y1="17" x2="8" y2="17"></line>
                <polyline points="10 9 9 9 8 9"></polyline>
            </svg>
            <span>New to CDKL5 Disorder?</span>
        </a>
    </div>
</div>

<!-- IMMEDIATE SCRIPT - Runs before CSS -->
<script>
(function() {
    var tabBar = document.getElementById('mobile-tab-bar');
    var popup = document.getElementById('about-popup');
    
    // On desktop: remove completely
    if (window.innerWidth > 900) {
        if (tabBar) tabBar.remove();
        if (popup) popup.remove();
    } else {
        // On mobile: show them
        if (tabBar) tabBar.style.display = 'flex';
        if (popup) popup.style.display = 'block';
    }
})();
</script>

<script>
// Footer newsletter: AJAX POST to the current page so Netlify (once the site is deployed)
// records the submission. Shows a friendly success message on completion.
;(function(){
    function serializeForm(form){
        var pairs = [];
        var fm = new FormData(form);
        for(var pair of fm.entries()){
            pairs.push(encodeURIComponent(pair[0]) + '=' + encodeURIComponent(pair[1]));
        }
        return pairs.join('&');
    }

    document.addEventListener('submit', function(e){
        var form = e.target;
        if(!form || form.id !== 'footer-newsletter') return;
        e.preventDefault();
        var body = serializeForm(form);
        // POST to the page's path — Netlify will accept submissions for registered forms
        fetch(window.location.pathname || '/', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: body
        }).then(function(resp){
            if(!resp.ok) throw new Error('Network response was not ok');
            form.style.display = 'none';
            var msg = document.getElementById('footer-newsletter-success');
            if(msg) msg.style.display = 'block';
        }).catch(function(){
            // Fallback to normal submit if AJAX fails
            form.submit();
        });
    }, false);
})();

// Mobile Tab Bar functionality - Wait for includes to load
function initMobileTabBar() {
    var tabBar = document.getElementById('mobile-tab-bar');
    var aboutPopup = document.getElementById('about-popup');
    
    // FORCE REMOVE on desktop - if screen width > 900px, delete the elements
    if (window.innerWidth > 900) {
        console.log('Desktop detected - removing mobile tab bar');
        if (tabBar) tabBar.remove();
        if (aboutPopup) aboutPopup.remove();
        return; // Exit early
    }
    
    console.log('Mobile detected - initializing tab bar');
    
    var aboutTabBtn = document.getElementById('about-tab-btn');
    
    console.log('Tab bar elements:', tabBar, aboutTabBtn, aboutPopup); // Debug
    
    if (aboutTabBtn && aboutPopup) {
        // Remove any existing listeners
        var newAboutBtn = aboutTabBtn.cloneNode(true);
        aboutTabBtn.parentNode.replaceChild(newAboutBtn, aboutTabBtn);
        aboutTabBtn = newAboutBtn;
        
        // Toggle About popup
        aboutTabBtn.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('About button clicked!'); // Debug
            
            var isActive = aboutPopup.classList.contains('active');
            aboutPopup.classList.toggle('active');
            console.log('Popup now:', isActive ? 'hidden' : 'visible'); // Debug
        }, true); // Use capture phase
        
        // Close popup when clicking outside
        document.addEventListener('click', function(e) {
            if (!aboutTabBtn.contains(e.target) && !aboutPopup.contains(e.target)) {
                aboutPopup.classList.remove('active');
            }
        });
        
        console.log('About button listener attached');
    } else {
        console.log('Missing elements - aboutTabBtn:', aboutTabBtn, 'aboutPopup:', aboutPopup);
    }
    
    // Highlight active tab based on current page
    var currentPage = window.location.pathname.split('/').pop() || 'index.html';
    var tabItems = document.querySelectorAll('.tab-item');
    
    tabItems.forEach(function(tab) {
        var tabPage = tab.getAttribute('data-page');
        if (currentPage.includes(tabPage) || (currentPage === '' && tabPage === 'index')) {
            tab.classList.add('active');
        }
    });
}

// Initialize when includes are loaded
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initMobileTabBar, 100); // Small delay for includes
    });
} else {
    setTimeout(initMobileTabBar, 100);
}

// Also try to init on includes:loaded event
document.addEventListener('includes:loaded', initMobileTabBar);

// Also check on window resize
window.addEventListener('resize', function() {
    if (window.innerWidth > 900) {
        var tabBar = document.getElementById('mobile-tab-bar');
        var aboutPopup = document.getElementById('about-popup');
        if (tabBar) tabBar.remove();
        if (aboutPopup) aboutPopup.remove();
    }
});
</script>
